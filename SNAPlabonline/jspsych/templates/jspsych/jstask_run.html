{% extends 'jspsych/base.html' %}
{% load static %}
{% block script %}

    /* create timeline */
    var subjid = '{{ task.subject }}';
    var task_url = '{{ task.task_url }}';
    var trialnum = 0; // This keeps an index only of the nAFC audio trials
    var timeline = [];
    jsPsych.data.addProperties({
        subject: subjid,
        task_url: task_url
    });

    {% for inst in task.instructions %}
        var welcome = {
          type: 'html-button-response',
          choices: ['Continue'],
          stimulus: '{{ inst }}'
        };
    timeline.push(welcome);
    {% endfor %}

    {% for trial in task.trials %}
        var jstrial = {
          type: '{{ trial.plugin }}',
          stimulus: '{% static  'jspsych/wav/'|add:trial.stimulus  %}',
          prompt: '{{ trial.prompt }}',
          choices: {{ trial.choices|safe }},
          on_finish: function() {
            trialnum = trialnum + 1;
            saveSingleTrial(jsPsych.data.getLastTrialData().json(), subjid, task_url, trialnum);
            }
        };
        timeline.push(jstrial);
    {% endfor %}


    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      show_progress_bar: true,
      on_finish: function() {
        saveData(jsPsych.data.get().json(), subjid, task_url, jsPsych.data.getInteractionData().json());
        jsPsych.data.displayData();
      }
    });

{% endblock script %}